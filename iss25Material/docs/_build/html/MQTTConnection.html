
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MQTTConnection &#8212; issLab2025 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ConwayLife25AdAttori" href="ConwayLife25AdAttori.html" />
    <link rel="prev" title="ConwayLife25" href="ConwayLife25.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="ConwayLife25AdAttori.html" title="ConwayLife25AdAttori"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="ConwayLife25.html" title="ConwayLife25"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">issLab2025 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MQTTConnection</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="mqttconnection">
<h1>MQTTConnection<a class="headerlink" href="#mqttconnection" title="Permalink to this heading">¶</a></h1>
<section id="uso-diretto-della-libreria-paho">
<h2>Uso diretto della libreria Paho<a class="headerlink" href="#uso-diretto-della-libreria-paho" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p>Per effettuare operazioni <em>publish/subscribe</em> usando un Broker MQTT usiamo la
liberia   <code class="docutils literal notranslate"><span class="pre">org.eclipse.paho.client.mqttv3</span></code> che contiene la classe <code class="docutils literal notranslate"><span class="pre">MqttClient</span></code></p></li>
<li><p><span class="slide3">Esempio</span> di uso diretto della libreria - Progetto <code class="docutils literal notranslate"><span class="pre">mqttdemo</span></code></p></li>
</ul>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttJavaPublisher</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="s2">&quot;tcp://localhost:1883&quot;</span><span class="p">,</span> <span class="s2">&quot;client1&quot;</span><span class="p">,</span> <span class="n">new</span> <span class="n">MemoryPersistence</span><span class="p">());</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">();</span>
<span class="o">...</span>
<span class="n">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;...&quot;</span><span class="p">;</span>
<span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span> <span class="s2">&quot;unibo/conn&quot;</span><span class="p">,</span>  <span class="n">new</span> <span class="n">MqttMessage</span><span class="p">(</span> <span class="n">msg</span><span class="o">.</span><span class="n">getBytes</span><span class="p">()</span> <span class="p">)</span> <span class="p">);</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttJavaSubscriber</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">client</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttClient</span><span class="p">(</span><span class="s2">&quot;tcp://localhost:1883&quot;</span><span class="p">,</span> <span class="s2">&quot;client2&quot;</span> <span class="p">);</span>
<span class="n">client</span><span class="o">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">new</span> <span class="n">MqttCallback</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">messageArrived</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">MqttMessage</span> <span class="n">message</span><span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
        <span class="o">...</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">});</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="oltre-la-libreria-paho">
<h2>Oltre la libreria Paho<a class="headerlink" href="#oltre-la-libreria-paho" title="Permalink to this heading">¶</a></h2>
<p>Per evitare di rimanere al basso livello (technology-dependent) della libreria Paho,
abbiamo realizzato, nel <span class="slide2">progetto unibo.basicomm23</span>, un insieme di classi che introducono livelli
crescenti di astrazione. Gli esempi sono nel <span class="slide3">progetto mqttdemo</span>.</p>
<section id="mqttsupport">
<h3>MqttSupport<a class="headerlink" href="#mqttsupport" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="slidekp">MqttSupport.java</span></p>
<p><span class="slide3">main.java.usingSupport</span></p>
</td>
<td><p>Usa (nascondendolo) <strong>MqttClient</strong> di Paho per realizzare le operazioni:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kt">boolean</span><span class="w"> </span><span class="nf">connectToBroker</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">clientid</span><span class="p">,</span><span class="w">  </span><span class="n">String</span><span class="w"> </span><span class="n">brokerAddr</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">disconnect</span><span class="p">()</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">cleartopic</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">subscribe</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">MqttCallback</span><span class="w"> </span><span class="n">handler</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">unsubscribe</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">publish</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">publish</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">retain</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">publish</span><span class="p">(</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">byte</span><span class="o">[]</span><span class="w"> </span><span class="n">payload</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">qos</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">retain</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="mqttconnectionbase">
<h3>MqttConnectionBase<a class="headerlink" href="#mqttconnectionbase" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="slidekp">MqttConnectionBase.java</span></p>
<p><span class="slide3">main.java.usingConnBase</span></p>
</td>
<td><p>Estende <em>MqttSupport</em>  per fornire metodi di connessione e di <span class="slide2">send/receive</span> di messaggi.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MqttConnectionBase</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">mqttBrokerAddr</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">clientid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="w"> </span><span class="p">)</span>
<span class="n">MqttConnectionBase</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">mqttBrokerAddr</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">clientid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="n">MqttCallback</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">send</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span>
<span class="n">String</span><span class="w"> </span><span class="nf">receive</span><span class="p">()</span>
</pre></div>
</div>
<p>L’operazione <span class="blue">receive</span> (bloccante) restitusice un valore <strong>non null</strong> solo se viene usato
il costruttore <strong>senza callback</strong> . In caso contrario, il messaggio ricevuto deve essere elaborato
in modo asincrono dal <em>callback</em> specificato nel costruttore.</p>
<p><a class="reference internal" href="#mqttconnectioncallbackforreceive"><span class="std std-ref">MqttConnectionCallbackForReceive</span></a></p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="mqttinteractionbase">
<h3>MqttInteractionBase<a class="headerlink" href="#mqttinteractionbase" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="slidekp">MqttInteractionBase.java</span></p>
<p><span class="slide3">main.java.usingInteractionBase</span></p>
</td>
<td><p>Implementa <span class="xref std std-ref">Interaction2021</span> per realizzare il concetto astratto di <span class="xref std std-ref">Interconnessione</span>
con riferimento a messaggi di tipo <span class="slidekp">String</span>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MqttInteractionBase</span><span class="p">(</span>
<span class="w">   </span><span class="n">String</span><span class="w"> </span><span class="n">mqttBrokerAddr</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">clientid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">sendonly</span><span class="w"> </span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="n">String</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w">  </span><span class="c1">//bloccante</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">reply</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="n">String</span><span class="w"> </span><span class="nf">receiveMsg</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
</pre></div>
</div>
<p>L’operazione <strong>request</strong> è realizzata in modo bloccante, cioè attende il messaggio di risposta
prima di restituire il controllo.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="mqttinteraction">
<h3>MqttInteraction<a class="headerlink" href="#mqttinteraction" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="slidekp">MqttInteraction.java</span></p>
<p><span class="slide3">main.java.usingInteraction</span></p>
</td>
<td><p>Implementa <span class="xref std std-ref">Interaction2023</span> per realizzare il concetto astratto di <span class="xref std std-ref">Interconnessione</span>
con riferimento a messaggi di tipo <span class="xref std std-ref">IApplMessage</span>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">MqttInteraction</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">mqttBrokerAddr</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">clientid</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topic</span><span class="p">,</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">alsoreceive</span><span class="p">)</span>
<span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tout</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span><span class="w"> </span><span class="c1">//bloccante</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">reply</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">receive</span><span class="p">(</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">;</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="w"> </span><span class="p">)</span><span class="w">  </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
</pre></div>
</div>
<p>L’operazione <strong>request</strong> è realizzata in modo bloccante, cioè attende il messaggio di risposta
prima di restituire il controllo.</p>
</td>
</tr>
</tbody>
</table>
</section>
<section id="mqttconnection25">
<h3>MqttConnection25<a class="headerlink" href="#mqttconnection25" title="Permalink to this heading">¶</a></h3>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 30%" />
<col style="width: 70%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><span class="slidekp">MqttConnection25.java</span></p>
<p><span class="slide3">main.java.usingMqttConnection25</span></p>
<a class="reference internal image-reference" href="_images/MqtttConnection25.png"><img alt="_images/MqtttConnection25.png" class="align-center" src="_images/MqtttConnection25.png" style="width: 80%;" /></a>
</td>
<td><p>Implementa <span class="xref std std-ref">Interaction</span> per realizzare una interconnessione
basata su due topic, ciascuna concepita come ingresso di un agente.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">//Operazioni di Interaction2023</span>
<span class="n">MqttConnection25</span><span class="p">(</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">clientName</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">mqttBrokerAddr</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topicIn</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">topicOut</span><span class="p">)</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">tout</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span><span class="w"> </span><span class="c1">//bloccante</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">reply</span><span class="p">(</span><span class="w">  </span><span class="n">IApplMessage</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="p">;</span>
<span class="n">IApplMessage</span><span class="w"> </span><span class="nf">receive</span><span class="p">(</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w"> </span><span class="p">;</span>

<span class="c1">//Operazioni di Interaction2021</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="n">String</span><span class="w"> </span><span class="nf">request</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span><span class="w">  </span><span class="c1">//bloccante</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">reply</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
<span class="n">String</span><span class="w"> </span><span class="nf">receiveMsg</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>

<span class="c1">//Chiusura</span>
<span class="kt">void</span><span class="w"> </span><span class="nf">close</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">Exception</span>
</pre></div>
</div>
<p>Possiede una coda <span class="blue">blockingQueue</span> su cui pone l’handler <a class="reference internal" href="#mqttconnectioncallbackforreceive"><span class="std std-ref">MqttConnectionCallbackForReceive</span></a>
i messaggi ricevuti sulla topic di ingresso (<code class="docutils literal notranslate"><span class="pre">topicIn</span></code>)</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">blockingQueue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LinkedBlockingDeque</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="classi-di-supporto-per-la-gestione-messaggi">
<h2>Classi di supporto per la gestione messaggi<a class="headerlink" href="#classi-di-supporto-per-la-gestione-messaggi" title="Permalink to this heading">¶</a></h2>
<section id="iapplmsghandlermqtt">
<h3>IApplMsgHandlerMqtt<a class="headerlink" href="#iapplmsghandlermqtt" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">public</span> <span class="n">interface</span> <span class="n">IApplMsgHandler</span>  <span class="p">{</span>
     <span class="n">public</span> <span class="n">String</span> <span class="n">getName</span><span class="p">();</span>
     <span class="n">public</span> <span class="n">void</span> <span class="n">elaborate</span><span class="p">(</span> <span class="n">IApplMessage</span> <span class="n">message</span><span class="p">,</span> <span class="n">Interaction</span>  <span class="n">conn</span> <span class="p">);</span>

<span class="n">IApplMsgHandlerMqtt</span> <span class="n">extends</span> <span class="n">IApplMsgHandler</span><span class="p">,</span>
                            <span class="n">org</span><span class="o">.</span><span class="n">eclipse</span><span class="o">.</span><span class="n">paho</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">mqttv3</span><span class="o">.</span><span class="n">MqttCallback</span><span class="o">.</span><span class="n">MqttCallback</span>
</pre></div>
</div>
</section>
<section id="mqttanswerhandler">
<h3>MqttAnswerHandler<a class="headerlink" href="#mqttanswerhandler" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MqttAnswerHandler</span> <span class="n">implements</span> <span class="n">IApplMsgHandlerMqtt</span>

<span class="n">MqttAnswerHandler</span><span class="p">(</span> <span class="n">String</span> <span class="n">name</span><span class="p">,</span>
           <span class="n">MqttConnection</span> <span class="n">conn</span><span class="p">,</span>
           <span class="n">IApplMsgHandler</span> <span class="n">handler</span><span class="p">,</span>
           <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockingQueue</span> <span class="p">)</span>
</pre></div>
</div>
<p>Definisce il metodo <strong>messageArrived</strong> che elabora il messaggio ricevuto
di tipo <span class="xref std std-ref">IApplMessage</span>, ponendo il messaggio stesso nella <strong>blockingQueue</strong>.</p>
</section>
<section id="mqttconnectioncallbackforreceive">
<h3>MqttConnectionCallbackForReceive<a class="headerlink" href="#mqttconnectioncallbackforreceive" title="Permalink to this heading">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MqttConnectionCallback</span> <span class="n">implements</span> <span class="n">MqttCallback</span>

<span class="n">MqttConnectionCallback</span><span class="p">(</span> <span class="n">BlockingQueue</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">blockingQueue</span> <span class="p">)</span>
<span class="n">public</span> <span class="n">void</span> <span class="n">messageArrived</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">MqttMessage</span> <span class="n">message</span><span class="p">)</span>   <span class="p">{</span>
  <span class="o">//</span><span class="n">pone</span> <span class="n">il</span> <span class="n">messaggio</span> <span class="n">nella</span> <span class="n">blockingQueue</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il metodo <strong>messageArrived</strong>  elabora il messaggio ricevuto,
di tipo String,  ponendo il messaggio stesso nella <strong>blockingQueue</strong>.</p>
</section>
</section>
<section id="uuuuuuuu">
<h2>uuuuuuuu<a class="headerlink" href="#uuuuuuuu" title="Permalink to this heading">¶</a></h2>
<p>Per evitare di rimanere al basso livello (technology-dependent) della libreria Paho,
abbiamo realizzato la classe <strong>MqttConnection</strong>,
che estende la classe astratta <span class="xref std std-ref">Connection</span>,
la quale a sua volte realizza la nostra idea astratta di <span class="xref std std-ref">Interaction</span>.</p>
<p>La classe <strong>MqttConnection</strong>:</p>
<ul class="simple">
<li><p>Costituisce una specializzazione della classe astratta <span class="xref std std-ref">Connection</span>
che fornisce metodi per l’uso di un broker MQTT.</p></li>
<li><p>Possiede una coda: <code class="docutils literal notranslate"><span class="pre">BlockingQueue&lt;String&gt;</span> <span class="pre">blockingQueue</span> <span class="pre">=</span> <span class="pre">new</span> <span class="pre">LinkedBlockingDeque&lt;String&gt;(10)</span></code></p></li>
<li><p>Ha un campo <code class="docutils literal notranslate"><span class="pre">String</span> <span class="pre">clientId</span></code> che identifica il client corrente.</p></li>
<li><p>Ha un campo <code class="docutils literal notranslate"><span class="pre">MqttClient</span> <span class="pre">client</span></code> che rappresenta il client MQTT.</p></li>
</ul>
<p>Procederemo evidenziando  diversi livelli di astrazione permessi da <strong>MqttConnection</strong>:</p>
<ol class="arabic simple">
<li><p>un <a class="reference internal" href="#mqttconnection-livello-1"><span class="std std-ref">prino livello</span></a> si basa sull’idea di steabilire una connessione con il broker MQTT (che permette
l’invio di messaggi con il metodo <strong>publish</strong>) e di usare una <strong>subscribe</strong> esplcita a una topic per ricevere messaggi
di tipo <span class="slidekp">String</span>,   in modo asincrono, avvalendosi di un <em>handler</em> che inmplemanta la classe <a class="reference internal" href="#iapplmsghandlermqtt"><span class="std std-ref">IApplMsgHandlerMqtt</span></a>.</p></li>
<li><p>un <a class="reference internal" href="#mqttconnection-livello-2"><span class="std std-ref">secondo livello</span></a>  si basa sull’idea di usare la classe <strong>MqttConnection</strong> come una risorsa logica di connessione ,
utlizzabile con i metodi <em>send</em> e <em>receive/receiveMsg</em>.
I metodi <em>receive</em> sono bloccanti, in quanto il chiamanate attende sulla coda di messaggi interna  (blockingQueue)
che viene popolata dall’handler di tipo  <cite>MqttConnectionCallback</cite> associato con una subscribe alla topic di input
(<em>infoIN</em>)
specificata nel costruttore  della forma <code class="docutils literal notranslate"><span class="pre">new</span> <span class="pre">MqttConnection(</span> <span class="pre">name,</span> <span class="pre">MqttBroker,</span> <span class="pre">&quot;infoIN&quot;,</span> <span class="pre">&quot;infoOUT&quot;</span> <span class="pre">)</span></code>.</p></li>
<li><p>un <a class="reference internal" href="#mqttconnection-livello-3"><span class="std std-ref">terzo livello</span></a> consiste nel vedare la classe <strong>MqttConnection</strong> come una
implementazione dell’astrazione
<span class="xref std std-ref">Interaction</span>, usando messaggi di tipo <span class="slidekp">IApplMessage</span>.</p></li>
</ol>
</section>
<section id="mqttconnection-livello-1">
<h2>MqttConnection - livello 1<a class="headerlink" href="#mqttconnection-livello-1" title="Permalink to this heading">¶</a></h2>
<p>Questo livello prevede l’uso del metodo <strong>publish</strong> da parte del sender e l’uso di una subscribe esplcita a una topic
da parte del receiver, che riceve messaggi <span class="slide3">di tipo String</span>
in modo asincrono, avvalendosi di un handler che inmplemanta la classe <a class="reference internal" href="#iapplmsghandlermqtt"><span class="std std-ref">IApplMsgHandlerMqtt</span></a>.</p>
<p>Questo uso della classe <strong>MqttConnection</strong> si può vedere nella classe <span class="slide3">WSConwaygui</span> del progetto <code class="docutils literal notranslate"><span class="pre">conwaygui</span></code>
che usa un handler custom di nome <code class="docutils literal notranslate"><span class="pre">MqttConnCallback</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MqttconnReceiverNoBlocking</span> <span class="n">mqttConn</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span> <span class="n">topic</span><span class="p">,</span> <span class="n">this</span>   <span class="p">);</span>
<span class="n">MqttconnSenderString</span>
</pre></div>
</div>
</section>
<section id="mqttconnection-livello-1b">
<h2>MqttConnection - livello 1b<a class="headerlink" href="#mqttconnection-livello-1b" title="Permalink to this heading">¶</a></h2>
<p>Si usano IApplMessage e publish</p>
<p><span class="slide3">Esempio</span> di uso ‘naive’ della classe <strong>MqttConnection</strong> - Progetto <code class="docutils literal notranslate"><span class="pre">mqttdemo</span></code></p>
<a class="reference internal image-reference" href="_images/MqttconnSendRec.jpg"><img alt="_images/MqttconnSendRec.jpg" class="align-center" src="_images/MqttconnSendRec.jpg" style="width: 60%;" /></a>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>SENDER</p></td>
<td><p>RECEIVER</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttconnSender</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mqttConn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnection</span><span class="p">(</span>   <span class="p">);</span>
<span class="n">mqttConn</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="s2">&quot;tcp://localhost:1883&quot;</span><span class="p">);</span>

<span class="o">...</span>
<span class="n">mqttConn</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span> <span class="s2">&quot;unibo/conn&quot;</span><span class="p">,</span>  <span class="n">msg</span> <span class="p">);</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttconnReceiver</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mqttConn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnection</span><span class="p">(</span>   <span class="p">);</span>
<span class="n">mqttConn</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;receiver&quot;</span><span class="p">,</span> <span class="s2">&quot;tcp://localhost:1883&quot;</span><span class="p">);</span>
<span class="n">mqttConn</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span> <span class="s2">&quot;unibo/conn&quot;</span>   <span class="p">);</span>
<span class="o">...</span>
<span class="n">String</span> <span class="n">message</span>  <span class="o">=</span> <span class="n">mqttConn</span><span class="o">.</span><span class="n">receiveMsg</span><span class="p">();</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
<section id="mqttconnection-livello-2">
<h2>MqttConnection - livello 2<a class="headerlink" href="#mqttconnection-livello-2" title="Permalink to this heading">¶</a></h2>
<p><span class="slide3">Esempio</span> di uso della classe <strong>MqttConnection</strong> vista come risorsa - Progetto <code class="docutils literal notranslate"><span class="pre">mqttdemo</span></code></p>
<a class="reference internal image-reference" href="_images/MqttconOUTIN.jpg"><img alt="_images/MqttconOUTIN.jpg" class="align-center" src="_images/MqttconOUTIN.jpg" style="width: 60%;" /></a>
<table class="docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>SENDER</p></td>
<td><p>RECEIVER</p></td>
</tr>
<tr class="row-even"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttconnresourceSender</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mqttConn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnection</span><span class="p">(</span>  <span class="n">name</span><span class="p">,</span> <span class="n">MqttBroker</span><span class="p">,</span> <span class="s2">&quot;infoIN&quot;</span><span class="p">,</span> <span class="s2">&quot;infoOUT&quot;</span> <span class="p">);</span>


<span class="o">...</span>
<span class="n">mqttConn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>  <span class="n">msg</span> <span class="p">);</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">MqttconnresourceReceiver</span>
</pre></div>
</div>
</td>
<td><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mqttConn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MqttConnection</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">MqttBroker</span><span class="p">,</span> <span class="s2">&quot;infoOUT&quot;</span><span class="p">,</span> <span class="s2">&quot;infoIN&quot;</span> <span class="p">);</span>

<span class="n">String</span> <span class="n">message</span>        <span class="o">=</span> <span class="n">mqttConn</span><span class="o">.</span><span class="n">receiveMsg</span><span class="p">();</span>
<span class="o">//</span><span class="n">OPPURE</span>
<span class="n">IApplMessage</span> <span class="n">msgInput</span> <span class="o">=</span> <span class="n">mqttConn</span><span class="o">.</span><span class="n">receive</span><span class="p">();</span>  <span class="o">//</span><span class="n">ereditata</span> <span class="n">da</span> <span class="n">Connection</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<p>Questo uso della classe <strong>MqttConnection</strong> si può vedere anche nella classe <span class="slide3">Life</span> del progetto <code class="docutils literal notranslate"><span class="pre">conwaygui</span></code>.</p>
</section>
<section id="mqttconnection-livello-3">
<h2>MqttConnection - livello 3<a class="headerlink" href="#mqttconnection-livello-3" title="Permalink to this heading">¶</a></h2>
<p>Uso di <span class="xref std std-ref">Interaction</span></p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">MQTTConnection</a><ul>
<li><a class="reference internal" href="#uso-diretto-della-libreria-paho">Uso diretto della libreria Paho</a></li>
<li><a class="reference internal" href="#oltre-la-libreria-paho">Oltre la libreria Paho</a><ul>
<li><a class="reference internal" href="#mqttsupport">MqttSupport</a></li>
<li><a class="reference internal" href="#mqttconnectionbase">MqttConnectionBase</a></li>
<li><a class="reference internal" href="#mqttinteractionbase">MqttInteractionBase</a></li>
<li><a class="reference internal" href="#mqttinteraction">MqttInteraction</a></li>
<li><a class="reference internal" href="#mqttconnection25">MqttConnection25</a></li>
</ul>
</li>
<li><a class="reference internal" href="#classi-di-supporto-per-la-gestione-messaggi">Classi di supporto per la gestione messaggi</a><ul>
<li><a class="reference internal" href="#iapplmsghandlermqtt">IApplMsgHandlerMqtt</a></li>
<li><a class="reference internal" href="#mqttanswerhandler">MqttAnswerHandler</a></li>
<li><a class="reference internal" href="#mqttconnectioncallbackforreceive">MqttConnectionCallbackForReceive</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uuuuuuuu">uuuuuuuu</a></li>
<li><a class="reference internal" href="#mqttconnection-livello-1">MqttConnection - livello 1</a></li>
<li><a class="reference internal" href="#mqttconnection-livello-1b">MqttConnection - livello 1b</a></li>
<li><a class="reference internal" href="#mqttconnection-livello-2">MqttConnection - livello 2</a></li>
<li><a class="reference internal" href="#mqttconnection-livello-3">MqttConnection - livello 3</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="ConwayLife25.html"
                          title="previous chapter">ConwayLife25</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="ConwayLife25AdAttori.html"
                          title="next chapter">ConwayLife25AdAttori</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/MQTTConnection.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="ConwayLife25AdAttori.html" title="ConwayLife25AdAttori"
             >next</a> |</li>
        <li class="right" >
          <a href="ConwayLife25.html" title="ConwayLife25"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">issLab2025 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">MQTTConnection</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, ANatali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>