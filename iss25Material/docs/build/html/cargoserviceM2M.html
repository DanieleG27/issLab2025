
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>cargoserviceM2M &#8212; issLab2025 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinxdoc.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="cargoserviceM2MGui" href="cargoserviceM2MGui.html" />
    <link rel="prev" title="issLab2025" href="index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="cargoserviceM2MGui.html" title="cargoserviceM2MGui"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="issLab2025"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">issLab2025 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cargoserviceM2M</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="cargoservicem2m">
<h1>cargoserviceM2M<a class="headerlink" href="#cargoservicem2m" title="Permalink to this heading">¶</a></h1>
<section id="m2m-start">
<h2>M2M start<a class="headerlink" href="#m2m-start" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Eseguire <a class="reference external" href="https://spring.io/">https://spring.io/</a></p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/springiostart.png"><img alt="_images/springiostart.png" class="align-center" src="_images/springiostart.png" style="width: 90%;" /></a>
</div></blockquote>
</li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">unzip</span>
<span class="n">gradlew</span> <span class="n">build</span>
</pre></div>
</div>
<p>Creare:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span>\<span class="n">main</span>\<span class="n">resources</span>\<span class="n">application</span><span class="o">.</span><span class="n">properties</span>
<span class="n">src</span>\<span class="n">main</span>\<span class="n">resources</span>\<span class="n">banner</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</section>
<section id="m2m-first-run">
<h2>M2M first run<a class="headerlink" href="#m2m-first-run" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gradlew</span> <span class="n">booturn</span> <span class="p">(</span><span class="n">INFO</span> <span class="n">messages</span><span class="p">)</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">9111</span><span class="o">/</span> <span class="p">(</span><span class="n">Whitelabel</span> <span class="n">Error</span> <span class="n">Page</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="m2m-required-library">
<h2>M2M required library<a class="headerlink" href="#m2m-required-library" title="Permalink to this heading">¶</a></h2>
<p>Inserire (necessaria per l’applicazione):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">applibs</span>
    <span class="n">cargoproduct</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="n">jar</span>
</pre></div>
</div>
</section>
<section id="m2m-build-gradle">
<h2>M2M build.gradle<a class="headerlink" href="#m2m-build-gradle" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">build</span><span class="o">.</span><span class="n">gradle</span>
    <span class="n">dependencies</span>
    <span class="n">plugins</span> <span class="o">...</span>
        <span class="nb">id</span> <span class="s1">&#39;org.springframework.boot&#39;</span> <span class="n">version</span> <span class="s1">&#39;3.3.4&#39;</span>
        <span class="nb">id</span> <span class="s1">&#39;eclipse&#39;</span>
        <span class="nb">id</span> <span class="s1">&#39;application&#39;</span>

    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;1.0&#39;</span>

    <span class="n">repositories</span> <span class="p">{</span>
        <span class="n">mavenCentral</span><span class="p">()</span>
        <span class="n">flatDir</span> <span class="p">{</span>   <span class="n">dirs</span> <span class="s1">&#39;../unibolibs&#39;</span>      <span class="p">}</span>
        <span class="n">flatDir</span> <span class="p">{</span>   <span class="n">dirs</span> <span class="s1">&#39;applibs&#39;</span>           <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">dependencies</span><span class="p">{</span>
        <span class="o">...</span>
        <span class="n">implementation</span> <span class="s1">&#39;com.googlecode.json-simple:json-simple:1.1.1&#39;</span>
        <span class="n">implementation</span> <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;org.json&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="s1">&#39;20180130&#39;</span>

        <span class="o">/*</span> <span class="n">Elasticsearch</span>   <span class="o">*/</span>
        <span class="n">implementation</span><span class="p">(</span><span class="s2">&quot;net.logstash.logback:logstash-logback-encoder:7.3&quot;</span><span class="p">)</span>
        <span class="o">//</span><span class="n">ATTENZIONE</span> <span class="n">ALLA</span> <span class="n">COMPATIBILITA</span> <span class="n">DELLA</span> <span class="n">VESRSIONE</span>

        <span class="n">implementation</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;uniboInterfaces&#39;</span>
        <span class="n">implementation</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;2p301&#39;</span>
        <span class="n">implementation</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;unibo.basicomm23-1.0&#39;</span>
        <span class="n">implementation</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;cargoproduct-1.0&#39;</span>

    <span class="n">application</span> <span class="p">{</span>
        <span class="o">//</span><span class="n">Define</span> <span class="n">the</span> <span class="n">main</span> <span class="k">class</span> <span class="nc">for</span> <span class="n">the</span> <span class="n">application</span><span class="o">.</span>
        <span class="n">mainClassName</span>    <span class="o">=</span> <span class="s1">&#39;unibo.disi.cargoserviceM2M.CargoserviceM2MApplication&#39;</span>
    <span class="p">}</span>

<span class="n">gradlew</span> <span class="n">eclipse</span>
<span class="n">gradlew</span> <span class="n">build</span>
</pre></div>
</div>
</section>
<section id="m2m-gitignore">
<h2>M2M .gitignore<a class="headerlink" href="#m2m-gitignore" title="Permalink to this heading">¶</a></h2>
<p>Aggiungere</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">logs</span>
</pre></div>
</div>
</section>
<section id="m2m-application-and-run">
<h2>M2M application and run<a class="headerlink" href="#m2m-application-and-run" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">new</span> <span class="n">package</span> <span class="n">src</span>\<span class="n">main</span>\<span class="n">java</span>\<span class="n">unibo</span>\<span class="n">disi</span>\<span class="n">cargoserviceM2M</span>\<span class="n">controller</span>
<span class="n">M2MCargoServiceController</span><span class="o">.</span><span class="n">java</span>
<span class="n">gradlew</span> <span class="n">run</span>
</pre></div>
</div>
</section>
<section id="m2m-usage">
<h2>M2M usage<a class="headerlink" href="#m2m-usage" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Eseguire</span><span class="p">:</span> <span class="n">PSLCallerHTTP</span><span class="o">.</span><span class="n">java</span>
</pre></div>
</div>
</section>
<section id="m2m-logging">
<h2>M2M logging<a class="headerlink" href="#m2m-logging" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span>\<span class="n">main</span>\<span class="n">resources</span>\<span class="n">logback</span><span class="o">.</span><span class="n">xml</span>
   <span class="n">definire</span> <span class="n">i</span> <span class="o">&lt;</span><span class="n">pettern</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Definire il logger:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">public</span> <span class="k">class</span> <span class="nc">CargoserviceM2MApplication</span> <span class="p">{</span>
    <span class="n">public</span>  <span class="n">final</span> <span class="n">static</span> <span class="n">Logger</span> <span class="n">logger</span>  <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="n">slf4j</span><span class="o">.</span><span class="n">LoggerFactory</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;m2m&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Osservare i messaggi di log in  <code class="docutils literal notranslate"><span class="pre">logs\m2m.log</span></code></p>
</section>
<section id="m2m-testing-local">
<h2>M2M testing  local<a class="headerlink" href="#m2m-testing-local" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span><span class="o">/</span><span class="n">main</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">unibo</span><span class="o">/</span><span class="n">disi</span><span class="o">/</span><span class="n">cargoserviceM2M</span><span class="o">/</span><span class="n">config</span><span class="o">/</span><span class="n">RestTemplateConfig</span><span class="o">.</span><span class="n">java</span>
<span class="n">src</span><span class="o">/</span><span class="n">test</span><span class="o">/</span><span class="n">java</span><span class="o">/</span><span class="n">unibo</span><span class="o">/</span><span class="n">disi</span><span class="o">/</span><span class="n">cargoserviceM2M</span><span class="o">/</span><span class="n">CargoserviceM2MApplicationTests</span><span class="o">.</span><span class="n">java</span>
<span class="n">gradlew</span> <span class="n">build</span> <span class="n">ESEGUE</span> <span class="n">I</span> <span class="n">TESTS</span> <span class="o">-</span><span class="n">x</span> <span class="n">test</span> <span class="n">LI</span> <span class="n">ESCLUDE</span>
</pre></div>
</div>
</section>
<section id="m2m-testing-using-elk">
<h2>M2M testing using ELK<a class="headerlink" href="#m2m-testing-using-elk" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="n">logback</span><span class="o">.</span><span class="n">xml</span>  <span class="o">-</span> <span class="n">aggiungere</span> <span class="n">ELK</span><span class="p">:</span>
<span class="n">In</span> <span class="n">build</span><span class="o">.</span><span class="n">gradle</span> <span class="o">-</span> <span class="n">aggiungere</span> <span class="n">dipendenza</span> <span class="n">per</span> <span class="n">Elasticsearch</span>
</pre></div>
</div>
<p>Il file <code class="docutils literal notranslate"><span class="pre">logstash.conf</span></code> nel progetto (<code class="docutils literal notranslate"><span class="pre">cargo2025\src\main\resources\logstash.conf</span></code>)
che definisce il file <code class="docutils literal notranslate"><span class="pre">yml</span></code>
che attiva <code class="docutils literal notranslate"><span class="pre">logstash</span></code> e <code class="docutils literal notranslate"><span class="pre">elasticsearch</span></code> definisce i <strong>nomi degli index</strong>
da selezionare in <strong>Kibana</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargo</span><span class="o">-</span><span class="n">logs</span><span class="o">-</span>
<span class="n">m2m</span><span class="o">-</span><span class="n">logs</span><span class="o">-</span>
</pre></div>
</div>
<p>Eseguire <code class="docutils literal notranslate"><span class="pre">src/test/java/unibo/disi/cargoserviceM2M/CargoserviceM2MApplicationTests.java</span></code>
ed esplorare <strong>Kibana in http://localhost:5601/</strong>.</p>
</section>
<section id="m2m-on-docker">
<h2>M2M on Docker<a class="headerlink" href="#m2m-on-docker" title="Permalink to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargoserviceM2M</span>\<span class="n">Dockerfile</span>
<span class="n">cargoserviceM2M</span>\<span class="n">cargoserviceM2M</span><span class="o">.</span><span class="n">bat</span>
<span class="n">cargoserviceM2M</span>\<span class="n">cargoserviceM2M</span><span class="o">.</span><span class="n">yml</span>

<span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">cargoservicem2m</span><span class="o">.</span><span class="n">yml</span>  <span class="o">-</span><span class="n">p</span> <span class="n">cargoservicem2m</span> <span class="n">up</span>
</pre></div>
</div>
</section>
<section id="m2m-discoverable">
<h2>M2M discoverable<a class="headerlink" href="#m2m-discoverable" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Estendiamo le dipenendenze in <em>build.gradle</em>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Dipendenza</span> <span class="n">per</span> <span class="n">Eureka</span> <span class="n">Client</span>
<span class="n">implementation</span> <span class="s1">&#39;com.netflix.eureka:eureka-client:1.10.18&#39;</span>
    <span class="o">//</span><span class="mf">1.10.18</span> <span class="n">compatibile</span> <span class="n">con</span> <span class="n">immagine</span> <span class="n">Spring</span> <span class="n">Cloud</span> <span class="n">Netflix</span> <span class="mf">3.</span><span class="n">x</span>
<span class="o">//</span> <span class="n">Dipendenza</span> <span class="n">per</span> <span class="n">Jersey</span> <span class="n">Client</span> <span class="p">(</span><span class="n">per</span> <span class="n">fare</span> <span class="n">richieste</span> <span class="n">HTTP</span><span class="p">)</span>
<span class="n">implementation</span> <span class="s1">&#39;com.sun.jersey:jersey-client:1.19.1&#39;</span>
<span class="n">implementation</span> <span class="s1">&#39;com.netflix.servo:servo-core:0.13.2&#39;</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Specifichiamo dove si trova Eureka in una variabile di ambiente di  <em>cargoserviceM2M.yml</em>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargoservice</span><span class="p">:</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">cargoservice</span><span class="p">:</span><span class="mf">3.0</span>
    <span class="c1">#image: natbodocker/cargoservice:3.0</span>
    <span class="n">container_name</span><span class="p">:</span> <span class="n">cargoservice</span>
    <span class="n">environment</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">EUREKA_CLIENT_SERVICEURL_DEFAULTZONE</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">eureka</span><span class="p">:</span><span class="mi">8761</span><span class="o">/</span><span class="n">eureka</span><span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Definiamo nella classe <strong>unibo.disi.cargoserviceM2M.EurekaServiceConfig</strong>
le proprietà rilevanti (<em>appaName</em>, <em>host</em> e <em>port</em>) del servizio da registare:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">appaName</span>
<span class="nd">@Override</span>
<span class="n">public</span> <span class="n">String</span> <span class="n">getAppname</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;m2mproductservice&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">//</span><span class="n">host</span>
    <span class="nd">@Override</span>
<span class="n">public</span> <span class="n">String</span> <span class="n">getHostName</span><span class="p">(</span><span class="n">boolean</span> <span class="n">refresh</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">&quot;localhost&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">...</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Definiamo i possibili URL del server Eureka nel file <code class="docutils literal notranslate"><span class="pre">src/main/resources/eureka-client.properties</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eureka</span><span class="o">.</span><span class="n">serviceUrl</span><span class="o">.</span><span class="n">defaultZone</span><span class="o">=</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">eureka</span><span class="p">:</span><span class="mi">8761</span><span class="o">/</span><span class="n">eureka</span><span class="o">/</span><span class="p">,</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">8761</span><span class="o">/</span><span class="n">eureka</span><span class="o">/</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Registriamo il servizio in <em>CargoserviceM2MApplication.java</em> usando una utility definita in <em>CommUtils.java</em>:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CommUtils</span><span class="o">.</span><span class="n">registerService</span><span class="p">(</span> <span class="n">main</span><span class="o">.</span><span class="n">java</span><span class="o">.</span><span class="n">EurekaServiceConfig</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="m2m-discoverable-usage">
<h2>M2M discoverable usage<a class="headerlink" href="#m2m-discoverable-usage" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Attiviamo il servizio ed eseguiamo un programma client che ne fa il discovery prima di
invocarne le operazioni HTTP-RESTful:
<code class="docutils literal notranslate"><span class="pre">src/unibo/disi/cargoserviceM2M/callers/PSDiscoverCallerHttp.java</span></code></p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">EurekaClient</span> <span class="n">eurekaClient</span>  <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">createEurekaClient</span><span class="p">();</span>
<span class="n">String</span><span class="p">[]</span>  <span class="n">hostPort</span> <span class="o">=</span> <span class="n">CommUtils</span><span class="o">.</span><span class="n">discoverService</span><span class="p">(</span><span class="n">eurekaClient</span><span class="p">,</span><span class="s2">&quot;m2mproductservice&quot;</span><span class="p">);</span>

<span class="n">BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;http://HOST:PORT&quot;</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;HOST&quot;</span><span class="p">,</span> <span class="n">hostPort</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;PORT&quot;</span><span class="p">,</span> <span class="n">hostPort</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="n">String</span> <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;/createProduct&quot;</span>
        <span class="n">URL</span> <span class="n">url</span> <span class="o">=</span> <span class="n">new</span> <span class="n">URL</span><span class="p">(</span><span class="n">BASE_URL</span> <span class="o">+</span> <span class="n">endpoint</span><span class="p">);</span>

<span class="o">//</span><span class="n">Escuzione</span> <span class="n">di</span> <span class="n">HTTP</span> <span class="n">POST</span>
        <span class="n">HttpURLConnection</span> <span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="n">HttpURLConnection</span><span class="p">)</span> <span class="n">url</span><span class="o">.</span><span class="n">openConnection</span><span class="p">();</span>
        <span class="n">con</span><span class="o">.</span><span class="n">setRequestMethod</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">);</span>
        <span class="n">con</span><span class="o">.</span><span class="n">setRequestProperty</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json;charset=UTF-8&quot;</span><span class="p">);</span>

        <span class="n">BufferedReader</span> <span class="ow">in</span> <span class="o">=</span> <span class="n">new</span> <span class="n">BufferedReader</span><span class="p">(</span><span class="n">new</span> <span class="n">InputStreamReader</span><span class="p">(</span><span class="n">con</span><span class="o">.</span><span class="n">getInputStream</span><span class="p">()));</span>
        <span class="n">String</span> <span class="n">inputLine</span><span class="p">;</span>
        <span class="n">StringBuffer</span> <span class="n">content</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StringBuffer</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">((</span><span class="n">inputLine</span> <span class="o">=</span> <span class="ow">in</span><span class="o">.</span><span class="n">readLine</span><span class="p">())</span> <span class="o">!=</span> <span class="n">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inputLine</span><span class="p">);</span>
        <span class="p">}</span>
<span class="o">//</span><span class="n">content</span><span class="o">.</span><span class="n">toString</span><span class="p">()</span> <span class="n">contiene</span> <span class="n">la</span> <span class="n">risposta</span> <span class="k">del</span> <span class="n">server</span>
        <span class="ow">in</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
        <span class="n">con</span><span class="o">.</span><span class="n">disconnect</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
</section>
<section id="m2m-connection-e-interaction">
<h2>M2M: Connection e Interaction<a class="headerlink" href="#m2m-connection-e-interaction" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Impostiamo qualche utility per la gestione delle richieste <code class="docutils literal notranslate"><span class="pre">HTTP</span></code> in <em>CommUtils.java</em> in modo da evitare
la verbosità precedente.
Ad esempio (si veda <code class="docutils literal notranslate"><span class="pre">src\main\java\unibo\disi\cargoserviceM2M\callers\PSLDiscoverCallerInteraction.java</span></code>)
:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">unibo.basicomm23.http.HttpConnection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">unibo.basicomm23.interfaces.Interaction</span><span class="p">;</span>
<span class="o">...</span>

<span class="n">private</span> <span class="n">void</span> <span class="n">doHTTPCall</span><span class="p">(</span> <span class="n">String</span> <span class="n">url</span><span class="p">,</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
    <span class="n">HttpConnection</span> <span class="n">httpConn</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HttpConnection</span><span class="p">(</span><span class="n">url</span><span class="p">);</span>
    <span class="n">org</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">simple</span><span class="o">.</span><span class="n">JSONObject</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">httpConn</span><span class="o">.</span><span class="n">callHTTP</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
    <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;doHTTPCall:&quot;</span> <span class="o">+</span> <span class="n">answer</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">private</span> <span class="n">void</span> <span class="n">doHLCall</span><span class="p">(</span> <span class="n">String</span> <span class="n">url</span><span class="p">,</span> <span class="n">String</span> <span class="n">msg</span> <span class="p">)</span> <span class="n">throws</span> <span class="ne">Exception</span> <span class="p">{</span>
    <span class="n">Interaction</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">ConnectionFactory</span><span class="o">.</span><span class="n">createClientSupport</span><span class="p">(</span><span class="n">ProtocolType</span><span class="o">.</span><span class="n">http</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">msg</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">answer</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span> <span class="o">//</span><span class="n">fa</span> <span class="n">httpConn</span><span class="o">.</span><span class="n">callHTTP</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">CommUtils</span><span class="o">.</span><span class="n">outmagenta</span><span class="p">(</span><span class="s2">&quot;doHLCall answer=&quot;</span> <span class="o">+</span> <span class="n">answer</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Approfondiamo il concetto di <em>HttpConnection</em> e quello, più generale, di <strong>Interaction</strong></p></li>
</ol>
</section>
<section id="m2m-ws">
<h2>M2M ws<a class="headerlink" href="#m2m-ws" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Abilitazione delle WS in Spring; file
<code class="docutils literal notranslate"><span class="pre">src\main\java\unibo\disi\cargoserviceM2M\config\WebSocketConfiguration.java</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="nd">@EnableWebSocket</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">WebSocketConfiguration</span> <span class="n">implements</span> <span class="n">WebSocketConfigurer</span> <span class="p">{</span>
    <span class="n">public</span> <span class="n">final</span> <span class="n">String</span> <span class="n">wsPath</span>  <span class="o">=</span> <span class="s2">&quot;wsupdates&quot;</span><span class="p">;</span>

    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">registerWebSocketHandlers</span><span class="p">(</span><span class="n">WebSocketHandlerRegistry</span> <span class="n">registry</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">new</span> <span class="n">WSServer</span><span class="p">(),</span> <span class="n">wsPath</span><span class="p">)</span><span class="o">.</span><span class="n">setAllowedOrigins</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>Abilitazione <strong>Cross-Origin Resource Sharing</strong> (CORS): file
<code class="docutils literal notranslate"><span class="pre">src\main\java\unibo\disi\cargoserviceM2M\config\WebCorsConfig.java</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@Configuration</span>
<span class="n">public</span> <span class="k">class</span> <span class="nc">CorsConfig</span> <span class="n">implements</span> <span class="n">WebMvcConfigurer</span> <span class="p">{</span>
    <span class="nd">@Override</span>
    <span class="n">public</span> <span class="n">void</span> <span class="n">addCorsMappings</span><span class="p">(</span><span class="n">CorsRegistry</span> <span class="n">registry</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">registry</span><span class="o">.</span><span class="n">addMapping</span><span class="p">(</span><span class="s2">&quot;/**&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">allowedOrigins</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">allowedMethods</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;PUT&quot;</span><span class="p">,</span> <span class="s2">&quot;DELETE&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="m2m-su-raspberrypi">
<h2>M2M su RaspberryPi<a class="headerlink" href="#m2m-su-raspberrypi" title="Permalink to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Defnire i file:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cargoserviceM2M</span>\<span class="n">DockerfileRasp</span>
<span class="n">cargoserviceM2M</span>\<span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">M2mRasp</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Trasferire su una cartella di RaspberryPi i file:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DockerfileRasp</span> <span class="p">(</span><span class="n">si</span> <span class="n">noti</span> <span class="n">ENV</span> <span class="n">RASP_ADDR</span><span class="o">=</span><span class="mf">192.168.1.248</span> <span class="n">per</span> <span class="n">evitare</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="p">)</span>
<span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">-</span><span class="n">M2mRasp</span><span class="o">.</span><span class="n">yml</span>
<span class="n">cargoserviceM2M</span><span class="o">-</span><span class="mf">1.0</span><span class="o">.</span><span class="n">tar</span>  <span class="p">(</span><span class="n">da</span> <span class="n">cargoserviceM2M</span>\<span class="n">build</span>\<span class="n">distributions</span>\<span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
</li>
<li><p>Eseguire su RaspberryPi:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">build</span> <span class="o">-</span><span class="n">f</span> <span class="n">DockerfileM2mRasp</span> <span class="o">-</span><span class="n">t</span> <span class="n">imgm2mrasp</span><span class="p">:</span><span class="mf">1.0</span> <span class="o">.</span>  <span class="p">(</span><span class="n">crea</span> <span class="n">imgm2mrasp</span><span class="p">:</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">it</span> <span class="o">--</span><span class="n">rm</span> <span class="o">--</span><span class="n">name</span> <span class="n">m2mrasp</span> <span class="o">-</span><span class="n">p9111</span><span class="p">:</span><span class="mi">9111</span><span class="o">/</span><span class="n">tcp</span>  <span class="o">--</span><span class="n">privileged</span> <span class="n">imgm2mrasp</span><span class="p">:</span><span class="mf">1.0</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<ol class="arabic simple">
<li><p>Eseguire <code class="docutils literal notranslate"><span class="pre">src\main\java\unibo\disi\cargoserviceM2M\callers\PSLDiscoverCallerInteraction.java</span></code></p></li>
</ol>
</section>
<section id="m2m-con-netty">
<h2>M2M con Netty<a class="headerlink" href="#m2m-con-netty" title="Permalink to this heading">¶</a></h2>
<p>SpringBoot (Tomcat), Jetty or Netty?</p>
<p>Si veda: <a class="reference external" href="https://www.baeldung.com/netty">https://www.baeldung.com/netty</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mvnrepository</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">artifact</span><span class="o">/</span><span class="n">io</span><span class="o">.</span><span class="n">netty</span><span class="o">/</span><span class="n">netty</span><span class="o">-</span><span class="nb">all</span>
<span class="n">implementation</span> <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;io.netty&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;netty-all&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="s1">&#39;4.1.24.Final&#39;</span>
<span class="n">implementation</span> <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;io.netty&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;netty-all&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="s1">&#39;4.1.115.Final&#39;</span>

<span class="o">//</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">mvnrepository</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">artifact</span><span class="o">/</span><span class="n">io</span><span class="o">.</span><span class="n">netty</span><span class="o">/</span><span class="n">netty</span><span class="o">-</span><span class="nb">all</span>
<span class="n">implementation</span> <span class="n">group</span><span class="p">:</span> <span class="s1">&#39;io.netty&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="s1">&#39;netty-all&#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">:</span> <span class="s1">&#39;4.0.0.CR1&#39;</span>


<span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">opens</span><span class="o">=</span><span class="n">java</span><span class="o">.</span><span class="n">base</span><span class="o">/</span><span class="n">java</span><span class="o">.</span><span class="n">nio</span><span class="o">.</span><span class="n">charset</span><span class="o">=</span><span class="n">ALL</span><span class="o">-</span><span class="n">UNNAMED</span>
</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">cargoserviceM2M</a><ul>
<li><a class="reference internal" href="#m2m-start">M2M start</a></li>
<li><a class="reference internal" href="#m2m-first-run">M2M first run</a></li>
<li><a class="reference internal" href="#m2m-required-library">M2M required library</a></li>
<li><a class="reference internal" href="#m2m-build-gradle">M2M build.gradle</a></li>
<li><a class="reference internal" href="#m2m-gitignore">M2M .gitignore</a></li>
<li><a class="reference internal" href="#m2m-application-and-run">M2M application and run</a></li>
<li><a class="reference internal" href="#m2m-usage">M2M usage</a></li>
<li><a class="reference internal" href="#m2m-logging">M2M logging</a></li>
<li><a class="reference internal" href="#m2m-testing-local">M2M testing  local</a></li>
<li><a class="reference internal" href="#m2m-testing-using-elk">M2M testing using ELK</a></li>
<li><a class="reference internal" href="#m2m-on-docker">M2M on Docker</a></li>
<li><a class="reference internal" href="#m2m-discoverable">M2M discoverable</a></li>
<li><a class="reference internal" href="#m2m-discoverable-usage">M2M discoverable usage</a></li>
<li><a class="reference internal" href="#m2m-connection-e-interaction">M2M: Connection e Interaction</a></li>
<li><a class="reference internal" href="#m2m-ws">M2M ws</a></li>
<li><a class="reference internal" href="#m2m-su-raspberrypi">M2M su RaspberryPi</a></li>
<li><a class="reference internal" href="#m2m-con-netty">M2M con Netty</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="index.html"
                          title="previous chapter">issLab2025</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="cargoserviceM2MGui.html"
                          title="next chapter">cargoserviceM2MGui</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/cargoserviceM2M.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="cargoserviceM2MGui.html" title="cargoserviceM2MGui"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="issLab2025"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">issLab2025 1.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cargoserviceM2M</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2024, ANatali.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.0.2.
    </div>
  </body>
</html>